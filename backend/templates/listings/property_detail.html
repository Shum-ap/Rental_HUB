{% load i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
<head>
    <meta charset="UTF-8">
    <title>{{ listing.title }} — RentalHub</title>
    <style>
        body {font-family: Arial, sans-serif; margin: 20px; background: #f7f9fb;}
        header, footer {
            display: flex; justify-content: space-between; align-items: center;
            background: #0078d7; color: white; padding: 15px 30px; border-radius: 6px;
        }
        footer {margin-top: 50px;}
        .lang-form select {padding: 6px 10px; border-radius: 5px; border: none;}
        .container {background: white; padding: 20px; border-radius: 8px; max-width: 900px; margin: 20px auto;}
        img {width: 100%; height: 300px; object-fit: cover; border-radius: 6px;}
        form input, form textarea, form select {
            width: 100%; padding: 8px; margin-top: 8px; border-radius: 5px; border: 1px solid #ccc;
        }
        form button {
            margin-top: 10px; padding: 10px 15px; background: #0078d7; color: white; border: none;
            border-radius: 5px; cursor: pointer;
        }
        form button:hover {background: #005fa3;}
        .feedback {background: #f1f1f1; padding: 10px; margin-top: 10px; border-radius: 6px;}
    </style>
</head>
<body>
<header>
    <div class="logo">🏠 RentalHub</div>
    <form action="{% url 'set_language' %}" method="post" class="lang-form">
        {% csrf_token %}
        <select name="language" onchange="this.form.submit()">
            {% get_current_language as LANGUAGE_CODE %}
            {% get_available_languages as LANGUAGES %}
            {% for lang_code, lang_name in LANGUAGES %}
                <option value="{{ lang_code }}" {% if lang_code == LANGUAGE_CODE %}selected{% endif %}>
                    {% if lang_code == 'ru' %}🇷🇺 Русский{% elif lang_code == 'en' %}🇬🇧 English{% elif lang_code == 'de' %}🇩🇪 Deutsch{% else %}{{ lang_name }}{% endif %}
                </option>
            {% endfor %}
        </select>
    </form>
    <nav>
        {% if user.is_authenticated %}
            <a href="{% url 'user-profile' %}">👤 {% trans "Profile" %}</a>
            <a href="/admin/logout/">🚪 {% trans "Logout" %}</a>
        {% else %}
            <a href="/admin/login/">🔑 {% trans "Login" %}</a>
        {% endif %}
    </nav>
</header>

<div class="container">
    <h1>{{ listing.title }}</h1>
    {% if listing.image %}
        <img src="{{ listing.image.url }}" alt="{{ listing.title }}">
    {% endif %}
    <p><strong>{% trans "Location" %}:</strong> {{ listing.location }}</p>
    <p><strong>{% trans "Type" %}:</strong> {{ listing.get_listing_type_display }}</p>
    <p><strong>{% trans "Price per night" %}:</strong> €{{ listing.price_eur }}</p>
    <p><strong>{% trans "Rooms" %}:</strong> {{ listing.rooms }}</p>
    <p>{{ listing.description }}</p>

    <h2>{% trans "Book This Property" %}</h2>
    <form method="post">
        {% csrf_token %}
        <input type="hidden" name="book" value="1">
        <label>{% trans "Start date" %}:</label>
        <input type="date" name="start_date" required>
        <label>{% trans "End date" %}:</label>
        <input type="date" name="end_date" required>
        <button type="submit">{% trans "Book Now" %}</button>
    </form>

    <h2>{% trans "Reviews" %}</h2>
    {% if feedbacks %}
        {% for fb in feedbacks %}
            <div class="feedback">
                <strong>{{ fb.user.first_name }}</strong> — ⭐ {{ fb.rating }}/5<br>
                <em>{{ fb.comment }}</em>
            </div>
        {% endfor %}
    {% else %}
        <p>{% trans "No reviews yet." %}</p>
    {% endif %}

    {% if user.is_authenticated %}
        <h3>{% trans "Leave a Review" %}</h3>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="review" value="1">
            <label>{% trans "Rating" %} (1–5):</label>
            <select name="rating" required>
                <option value="">{% trans "Select" %}</option>
                {% for i in "12345" %}
                    <option value="{{ i }}">{{ i }}</option>
                {% endfor %}
            </select>
            <label>{% trans "Comment" %}:</label>
            <textarea name="comment" rows="4"></textarea>
            <button type="submit">{% trans "Submit Review" %}</button>
        </form>
    {% else %}
        <p><a href="/admin/login/">{% trans "Log in to leave a review." %}</a></p>
    {% endif %}
</div>

<footer>
    <p>&copy; 2025 RentalHub. {% trans "All rights reserved." %}</p>
</footer>
</body>
</html>
